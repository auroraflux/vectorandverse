<div id="global-lightbox" class="lightbox-overlay" aria-hidden="true" role="dialog">
  <div class="lightbox-content">
    <img id="lightbox-image" src="" alt="" />
  </div>
</div>

<style>
  .lightbox-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000; /* Ensure it's above other content */
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.2s ease, visibility 0.2s ease;
  }

  /* State for when the lightbox is open */
  .lightbox-overlay[aria-hidden="false"] {
    opacity: 1;
    visibility: visible;
  }

  .lightbox-content {
    max-width: 90vw; /* Max width relative to viewport */
    max-height: 90vh; /* Max height relative to viewport */
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .lightbox-content img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain; /* Ensures the entire image is visible within its bounds */
  }
</style>

<script is:inline>
  const lightboxOverlay = document.getElementById('global-lightbox');
  const lightboxImage = document.getElementById('lightbox-image');
  let currentScrollPosition = 0; // To restore scroll position after closing

  function openLightbox(src, alt) {
    lightboxImage.src = src;
    lightboxImage.alt = alt;
    lightboxOverlay.setAttribute('aria-hidden', 'false');
    // Prevent scrolling on the body when lightbox is open
    currentScrollPosition = window.scrollY;
    document.body.style.overflow = 'hidden';
    document.body.style.position = 'fixed';
    document.body.style.top = `-${currentScrollPosition}px`;
    document.body.style.width = '100%';
  }

  function closeLightbox() {
    lightboxOverlay.setAttribute('aria-hidden', 'true');
    lightboxImage.src = ''; // Clear image src to free memory and prevent flickering
    lightboxImage.alt = '';
    // Restore scrolling on the body
    document.body.style.overflow = '';
    document.body.style.position = '';
    document.body.style.top = '';
    document.body.style.width = '';
    window.scrollTo(0, currentScrollPosition);
  }

  // Close on click anywhere on the overlay (but not the image itself)
  lightboxOverlay.addEventListener('click', (event) => {
    if (event.target === lightboxOverlay || event.target.parentElement === lightboxOverlay) {
      closeLightbox();
    }
  });

  // Close on ESC key press
  document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape' && lightboxOverlay.getAttribute('aria-hidden') === 'false') {
      closeLightbox();
    }
  });

  // Attach click listeners to all image triggers using event delegation
  document.addEventListener('click', (event) => {
    const target = event.target.closest('.lightbox-trigger');
    if (target) {
      const src = target.dataset.src;
      const alt = target.dataset.alt;
      if (src) {
        openLightbox(src, alt);
      }
    }
  });
</script>