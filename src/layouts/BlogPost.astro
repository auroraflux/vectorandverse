---
import Layout from './Layout.astro';
import Header from '../components/Header.astro';
import ResponsiveImage from '../components/ResponsiveImage.astro';
import ReadingProgress from '../components/ReadingProgress.astro';
import ScrollTextReveal from '../components/ScrollTextReveal.astro';
import ReadingFocus from '../components/ReadingFocus.astro';
import '../styles/global.css';

export interface Props {
  title: string;
  description: string;
  date: Date;
  heroImage?: string;
  heroImageAlt?: string;
}

const { title, description, date, heroImage, heroImageAlt } = Astro.props;
const formattedDate = new Intl.DateTimeFormat('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
}).format(date);

const month = new Intl.DateTimeFormat('en-US', {
  month: 'short'
}).format(date).toUpperCase();

const year = new Intl.DateTimeFormat('en-US', {
  year: 'numeric'
}).format(date);

const day = new Intl.DateTimeFormat('en-US', {
  day: '2-digit'
}).format(date);
---

<Layout 
  title={title} 
  description={description}
  image={heroImage}
  type="article"
>
  <Header variant="article" />
  <ReadingProgress />
  <ScrollTextReveal />
  {/* <ReadingFocus /> - Temporarily disabled */}
  <div class="fade-in relative">
    {/* Animated grid background that matches the homepage */}
    <div class="fixed inset-0 -z-10">
      <div class="absolute inset-0 bg-gray-50"></div>
      <div class="absolute inset-0 bg-grid-pattern opacity-40"></div>
      {/* Moving gradient overlay - subtle variant for articles */}
      <div class="absolute inset-0">
        <div class="absolute inset-0 bg-gradient-animated-subtle"></div>
      </div>
    </div>
    {/* Hero Section with Full Background */}
    <header class="relative h-[600px] md:h-[700px] lg:h-[800px] flex items-end overflow-hidden">
      {/* Background Image or Gradient */}
      {heroImage ? (
        <>
          <img 
            src={heroImage} 
            alt={heroImageAlt || title}
            loading="eager"
            fetchpriority="high"
            class="absolute inset-0 w-full h-full object-cover"
          />
          {/* Gradient Overlay - connects with header vignette */}
          <div class="absolute inset-0" 
               style="background: linear-gradient(to top, 
                      rgba(0,0,0,0.9) 0%, 
                      rgba(0,0,0,0.895) 2.5%, 
                      rgba(0,0,0,0.88) 5%, 
                      rgba(0,0,0,0.86) 7.5%,
                      rgba(0,0,0,0.84) 10%, 
                      rgba(0,0,0,0.82) 12.5%,
                      rgba(0,0,0,0.78) 15%,
                      rgba(0,0,0,0.75) 17.5%,
                      rgba(0,0,0,0.72) 20%,
                      rgba(0,0,0,0.69) 22.5%,
                      rgba(0,0,0,0.66) 25%,
                      rgba(0,0,0,0.63) 27.5%,
                      rgba(0,0,0,0.6) 30%,
                      rgba(0,0,0,0.57) 32.5%,
                      rgba(0,0,0,0.54) 35%,
                      rgba(0,0,0,0.51) 37.5%,
                      rgba(0,0,0,0.48) 40%,
                      rgba(0,0,0,0.46) 42.5%,
                      rgba(0,0,0,0.44) 45%,
                      rgba(0,0,0,0.42) 47.5%,
                      rgba(0,0,0,0.4) 50%,
                      rgba(0,0,0,0.42) 52.5%,
                      rgba(0,0,0,0.44) 55%,
                      rgba(0,0,0,0.46) 57.5%,
                      rgba(0,0,0,0.48) 60%,
                      rgba(0,0,0,0.51) 62.5%,
                      rgba(0,0,0,0.54) 65%,
                      rgba(0,0,0,0.57) 67.5%,
                      rgba(0,0,0,0.6) 70%,
                      rgba(0,0,0,0.63) 72.5%,
                      rgba(0,0,0,0.66) 75%,
                      rgba(0,0,0,0.69) 77.5%,
                      rgba(0,0,0,0.72) 80%,
                      rgba(0,0,0,0.75) 82.5%,
                      rgba(0,0,0,0.78) 85%,
                      rgba(0,0,0,0.82) 87.5%,
                      rgba(0,0,0,0.84) 90%,
                      rgba(0,0,0,0.86) 92.5%,
                      rgba(0,0,0,0.88) 95%,
                      rgba(0,0,0,0.895) 97.5%,
                      rgba(0,0,0,0.9) 100%);"></div>
        </>
      ) : (
        <div class="absolute inset-0 bg-gradient-to-br from-gray-900 to-gray-800"></div>
      )}
      
      {/* Content Container */}
      <div class="relative z-10 w-full pt-20 md:pt-0 pb-12 md:pb-16 lg:pb-20">
        <div class="max-w-3xl mx-auto px-6">
          {/* Date Display */}
          <div class="mb-8">
            <div class="inline-flex items-baseline text-white/90 text-3xl md:text-4xl leading-none" style="text-shadow: 0 4px 30px rgba(0,0,0,0.15), 0 2px 10px rgba(0,0,0,0.3), 0 4px 30px rgba(0,0,0,0.7);">
              <span style="font-weight: 800; font-feature-settings: 'tnum'; font-variation-settings: 'wght' 800;">
                {day}
              </span>
              <span class="uppercase" style="font-weight: 300; letter-spacing: -0.05em; font-variation-settings: 'wght' 300;">
                {month}
              </span>
              <span style="font-weight: 800; font-feature-settings: 'tnum'; font-variation-settings: 'wght' 800;">
                {year}
              </span>
            </div>
          </div>
          
          {/* Title */}
          <h1 class="text-5xl md:text-6xl lg:text-7xl text-white leading-[1.1] md:leading-[0.9] mb-6" 
              style="font-weight: 850; letter-spacing: -0.04em; text-shadow: 0 4px 30px rgba(0,0,0,0.15), 0 2px 10px rgba(0,0,0,0.3), 0 4px 30px rgba(0,0,0,0.7);">
            {title}
          </h1>
          
          {/* Description */}
          <p class="text-xl md:text-2xl text-white/80 leading-relaxed max-w-3xl" 
             style="font-weight: 500; text-shadow: 0 2px 4px rgba(0,0,0,0.9), 0 4px 8px rgba(0,0,0,0.7), 0 8px 16px rgba(0,0,0,0.5), 0 16px 32px rgba(0,0,0,0.3);">
            {description}
          </p>
        </div>
      </div>
    </header>
    
    {/* Article Content */}
    <article class="max-w-3xl mx-auto px-6 pt-16 pb-24">
      <div class="prose prose-lg max-w-none prose-headings:font-bold prose-strong:font-black">
        <slot />
      </div>
    </article>
  </div>
</Layout>

<style>
  @import "tailwindcss";
  @reference;
  
  article :global(h2) {
    @apply text-3xl mt-12 mb-4 lowercase;
    font-weight: 850 !important;
    font-variation-settings: 'wght' 850 !important;
  }
  
  article :global(h2::after) {
    content: '';
    display: block;
    height: 2px;
    margin-top: 0.5rem;
    background: linear-gradient(to right, rgb(209, 213, 219), transparent);
  }
  
  article :global(h3) {
    @apply text-2xl mt-8 mb-3 lowercase;
    font-weight: 850 !important;
    font-variation-settings: 'wght' 850 !important;
  }
  
  article :global(h3::after) {
    content: '';
    display: block;
    height: 2px;
    margin-top: 0.5rem;
    background: linear-gradient(to right, rgb(209, 213, 219), transparent);
  }
  
  article :global(p) {
    @apply mb-6 leading-relaxed;
  }
  
  article :global(blockquote) {
    @apply pl-6 my-8 border-l-3 border-gray-300 text-gray-700;
  }
  
  article :global(blockquote p) {
    @apply mb-2;
  }
  
  article :global(pre) {
    @apply bg-gray-50 border border-gray-200 p-4 overflow-x-auto my-6 text-sm;
  }
  
  article :global(code) {
    @apply bg-gray-100 px-1 py-0.5 rounded text-sm;
  }
  
  article :global(pre code) {
    @apply bg-transparent p-0;
  }
  
  article :global(ul) {
    @apply list-disc pl-6 my-6;
  }
  
  article :global(ol) {
    @apply list-decimal pl-6 my-6;
  }
  
  article :global(li) {
    @apply mb-2;
  }
  
  article :global(table) {
    @apply w-full my-8 text-base;
  }
  
  article :global(thead) {
    @apply border-b-2 border-gray-200;
  }
  
  article :global(th) {
    @apply font-semibold text-left px-3 py-3;
  }
  
  article :global(td) {
    @apply px-3 py-3;
  }
  
  article :global(tbody tr) {
    @apply border-b border-gray-100;
  }
  
  article :global(tbody tr:last-child) {
    @apply border-b-0;
  }
  
  article :global(tbody td:first-child) {
    @apply font-medium;
  }
  
  /* Custom image styling with rounded corners and lightbox cursor */
  article :global(img) {
    @apply rounded-lg shadow-lg cursor-zoom-in transition-shadow duration-300;
  }
  
  article :global(img:hover) {
    @apply shadow-xl;
  }
  
  /* Video styling to match images */
  article :global(video) {
    @apply w-full my-8 rounded-lg shadow-lg;
  }
  
  /* Bold italic text in prose */
  article :global(em strong),
  article :global(strong em),
  article :global(i b),
  article :global(b i),
  article :global(em em),
  article :global(i i) {
    font-weight: 900 !important;
    font-style: italic;
    font-variation-settings: 'wght' 900 !important;
  }
  
  /* Triple asterisk for extra bold italic */
  article :global(strong em),
  article :global(em strong) {
    font-weight: 900 !important;
    font-style: italic !important;
    font-variation-settings: 'wght' 900 !important;
  }
  
  /* Make bold text more prominent */
  article :global(strong),
  article :global(b),
  article :global(.prose strong),
  article :global(.prose b) {
    font-weight: 900 !important;
    font-variation-settings: 'wght' 900 !important;
    color: rgb(17, 24, 39) !important;
  }
</style>

<script>
  // Add lightbox functionality to all images in the article
  document.addEventListener('astro:page-load', () => {
    const article = document.querySelector('article');
    if (!article) return;
    
    // Find all images in the article
    const images = article.querySelectorAll('img');
    
    images.forEach((img) => {
      // Skip if already processed
      if (img.dataset.lightbox === 'true') return;
      
      // Add lightbox attributes
      img.dataset.lightbox = 'true';
      img.dataset.fullSrc = img.src;
      
      // Add lazy loading
      img.loading = 'lazy';
      
      // Ensure proper styling
      img.classList.add('w-full', 'rounded-lg', 'shadow-lg', 'cursor-zoom-in', 'hover:shadow-xl', 'transition-shadow', 'duration-300');
    });
  });
</script>